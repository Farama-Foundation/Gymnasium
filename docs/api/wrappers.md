---
title: Wrappers
lastpage:
---

# Wrappers

```{eval-rst}
.. autoclass:: gymnasium.Wrapper
```

## Attributes
```{eval-rst}
.. autofunction:: gymnasium.Wrapper.action_space
.. autofunction:: gymnasium.Wrapper.observation_space
.. autofunction:: gymnasium.Wrapper.metadata
.. autofunction:: gymnasium.Wrapper.spec
.. autofunction:: gymnasium.Wrapper.np_random
.. autofunction:: gymnasium.Wrapper.render_mode
.. autofunction:: gymnasium.Wrapper.unwrapped
```

## Action Wrapper

```{eval-rst}
.. autoclass:: gymnasium.ActionWrapper
.. autofunction:: gymnasium.ActionWrapper.action
```

## Observation Wrapper
```{eval-rst}
.. autoclass:: gymnasium.ObservationWrapper
.. autofunction:: gymnasium.ObservationWrapper.observation
```

## Reward Wrapper
```{eval-rst}
.. autoclass:: gymnasium.RewardWrapper
.. autofunction:: gymnasium.RewardWrapper.reward
```

## General Wrappers

Sometimes you might need to implement a wrapper that does some more complicated modifications (e.g. modify the
reward based on data in `info` or change the rendering behavior). 
Such wrappers can be implemented by inheriting from `Wrapper`. 

- You can set a new action or observation space by defining `self.action_space` or `self.observation_space` in `__init__`, respectively
- You can set new metadata and reward range by defining `self.metadata` and `self.reward_range` in `__init__`, respectively
- You can override `step`, `render`, `close` etc. If you do this, you can access the environment that was passed
to your wrapper (which *still* might be wrapped in some other wrapper) by accessing the attribute `self.env`.

Let's also take a look at an example for this case. Most MuJoCo environments return a reward that consists
of different terms: For instance, there might be a term that rewards the agent for completing the task and one term that
penalizes large actions (i.e. energy usage). Usually, you can pass weight parameters for those terms during
initialization of the environment. However, *Reacher* does not allow you to do this! Nevertheless, all individual terms
of the reward are returned in `info`, so let us build a wrapper for Reacher that allows us to weight those terms:

```python
import gymnasium as gym

class ReacherRewardWrapper(gym.Wrapper):
    def __init__(self, env, reward_dist_weight, reward_ctrl_weight):
        super().__init__(env)
        self.reward_dist_weight = reward_dist_weight
        self.reward_ctrl_weight = reward_ctrl_weight

    def step(self, action):
        obs, _, terminated, truncated, info = self.env.step(action)
        reward = (
            self.reward_dist_weight * info["reward_dist"]
            + self.reward_ctrl_weight * info["reward_ctrl"]
        )
        return obs, reward, terminated, truncated, info
```

```{note}
It is *not* sufficient to use a `RewardWrapper` in this case!
```

## Gymnasium Wrappers

| Name                      | Type                           | Arguments                                                                                                                                                                                                                     | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|---------------------------|--------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `AtariPreprocessing`      | `gymnasium.Wrapper`            | `env: gymnasium.Env`, `noop_max: int = 30`, `frame_skip: int = 4`, `screen_size: int = 84`, `terminal_on_life_loss: bool = False`, `grayscale_obs: bool = True`, `grayscale_newaxis: bool = False`, `scale_obs: bool = False` | Implements the best practices from Machado et al. (2018), "Revisiting the Arcade Learning Environment: Evaluation Protocols and Open Problems for General Agents" but will be deprecated soon.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `AutoResetWrapper`        | `gymnasium.Wrapper`            | `env`                                                                                                                                                                                                                         | The wrapped environment will automatically reset when the done state is reached. Make sure you read the documentation before using this wrapper!                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `ClipAction`              | `gymnasium.ActionWrapper`      | `env`                                                                                                                                                                                                                         | Clip the continuous action to the valid bound specified by the environment's `action_space`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `FilterObservation`       | `gymnasium.ObservationWrapper` | `env`, `filter_keys=None`                                                                                                                                                                                                     | If you have an environment that returns dictionaries as observations, but you would like to only keep a subset of the entries, you can use this wrapper. `filter_keys` should be an iterable that contains the keys that are kept in the new observation. If it is `None`, all keys will be kept and the wrapper has no effect.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 
| `FlattenObservation`      | `gymnasium.ObservationWrapper` | `env`                                                                                                                                                                                                                         | Observation wrapper that flattens the observation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| `FrameStack`              | `gymnasium.ObservationWrapper` | `env`, `num_stack`, `lz4_compress=False`                                                                                                                                                                                      | Observation wrapper that stacks the observations in a rolling manner. For example, if the number of stacks is 4, then the returned observation contains the most recent 4 observations. Observations will be objects of type `LazyFrames`. This object can be cast to a numpy array via `np.asarray(obs)`. You can also access single frames or slices via the usual `__getitem__` syntax. If `lz4_compress` is set to true, the `LazyFrames` object will compress the frames internally (losslessly). The first observation (i.e. the one returned by `reset`) will consist of `num_stack` repitions of the first frame.                                                                                                                                                                                                                                                                                                      |
| `GrayScaleObservation`    | `gymnasium.ObservationWrapper` | `env`, `keep_dim=False`                                                                                                                                                                                                       | Convert the image observation from RGB to gray scale. By default, the resulting observation will be 2-dimensional. If `keep_dim` is set to true, a singleton dimension will be added (i.e. the observations are of shape AxBx1).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `NormalizeReward`         | `gymnasium.Wrapper`            | `env`, `gamma=0.99`, `epsilon=1e-8`                                                                                                                                                                                           | This wrapper will normalize immediate rewards s.t. their exponential moving average has a fixed variance. `epsilon` is a stability parameter and `gamma` is the discount factor that is used in the exponential moving average. The exponential moving average will have variance `(1 - gamma)**2`. The scaling depends on past trajectories and rewards will not be scaled correctly if the wrapper was newly instantiated or the policy was changed recently.                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `NormalizeObservation`    | `gymnasium.Wrapper`            | `env`, `epsilon=1e-8`                                                                                                                                                                                                         | This wrapper will normalize observations s.t. each coordinate is centered with unit variance. The normalization depends on past trajectories and observations will not be normalized correctly if the wrapper was newly instantiated or the policy was changed recently. `epsilon` is a stability parameter that is used when scaling the observations.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `OrderEnforcing`          | `gymnasium.Wrapper`            | `env`                                                                                                                                                                                                                         | This will produce an error if `step` is called before an initial `reset`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `PixelObservationWrapper` | `gymnasium.ObservationWrapper` | `env`, `pixels_only=True`, `render_kwargs=None`, `pixel_keys=("pixels",)`                                                                                                                                                     | Augment observations by pixel values obtained via `render`. You can specify whether the original observations should be discarded entirely or be augmented by setting `pixels_only`. Also, you can provide keyword arguments for `render`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `RecordEpisodeStatistics` | `gymnasium.Wrapper`            | `env`, `deque_size=100`                                                                                                                                                                                                       | This will keep track of cumulative rewards and episode lengths. At the end of an episode, the statistics of the episode will be added to `info`. Moreover, the rewards and episode lengths are stored in buffers that can be accessed via `wrapped_env.return_queue` and `wrapped_env.length_queue` respectively. The size of these buffers can be set via `deque_size`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `RecordVideo`             | `gymnasium.Wrapper`            | `env`, `video_folder: str`, `episode_trigger: Callable[[int], bool] = None`, `step_trigger: Callable[[int], bool] = None`, `video_length: int = 0`, `name_prefix: str = "rl-video"`                                           | This wrapper will record videos of rollouts. The results will be saved in the folder specified via `video_folder`. You can specify a prefix for the filenames via `name_prefix`. Usually, you only want to record the environment intermittently, say every hundreth episode. To allow this, you can pass `episode_trigger` or `step_trigger`. At most one of these should be passed. These functions will accept an episode index or step index, respectively. They should return a boolean that indicates whether a recording should be started at this point. If neither `episode_trigger`, nor `step_trigger` is passed, a default `episode_trigger` will be used. By default, the recording will be stopped once a done signal has been emitted by the environment. However, you can also create recordings of fixed length (possibly spanning several episodes) by passing a strictly positive value for `video_length`. |
| `RescaleAction`           | `gymnasium.ActionWrapper`      | `env`, `min_action`, `max_action`                                                                                                                                                                                             | Rescales the continuous action space of the environment to a range \[`min_action`, `max_action`], where `min_action` and `max_action` are numpy arrays or floats.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| `ResizeObservation`       | `gymnasium.ObservationWrapper` | `env`, `shape`                                                                                                                                                                                                                | This wrapper works on environments with image observations (or more generally observations of shape AxBxC) and resizes the observation to the shape given by the tuple `shape`. The argument `shape` may also be an integer. In that case, the observation is scaled to a square of sidelength `shape`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `TimeAwareObservation`    | `gymnasium.ObservationWrapper` | `env`                                                                                                                                                                                                                         | Augment the observation with current time step in the trajectory (by appending it to the observation). This can be useful to ensure that things stay Markov. Currently it only works with one-dimensional observation spaces.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `TimeLimit`               | `gymnasium.Wrapper`            | `env`, `max_episode_steps=None`                                                                                                                                                                                               | Probably the most useful wrapper in Gymnasium. This wrapper will emit a done signal if the specified number of steps is exceeded in an episode. In order to be able to distinguish termination and truncation, you need to check `info`. If it does not contain the key `"TimeLimit.truncated"`, the environment did not reach the timelimit. Otherwise, `info["TimeLimit.truncated"]` will be true if the episode was terminated because of the time limit.                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `TransformObservation`    | `gymnasium.ObservationWrapper` | `env`, `f`                                                                                                                                                                                                                    | This wrapper will apply `f` to observations                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `TransformReward`         | `gymnasium.RewardWrapper`      | `env`, `f`                                                                                                                                                                                                                    | This wrapper will apply `f` to rewards                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `VectorListInfo`          | `gymnasium.Wrapper`            | `env`                                                                                                                                                                                                                         | This wrapper will convert the info of a vectorized environment from the `dict` format to a `list` of dictionaries where the _i-th_ dictionary contains info of the _i-th_ environment. If using other wrappers that perform operation on info like `RecordEpisodeStatistics`, this need to be the outermost wrapper.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
