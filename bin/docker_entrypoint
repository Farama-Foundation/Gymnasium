#!/bin/bash

set -ex

#Set up display; otherwise rendering will fail
Xvfb :0 -screen 0 1024x768x24 &
export DISPLAY=:0

#Wait for the file to come up
file="/tmp/.X11-unix/X$DISPLAY"
for i in {1..10}; do
if [ -e "$file" ]; then
break
fi

bash
Copy code
echo "Waiting for $file to be created (try $i/10)"
sleep "$i"
done

if ! [ -e "$file" ]; then
echo "Timing out: $file was not created"
exit 1
else
exec "$@"
fi
