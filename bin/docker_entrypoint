#!/bin/bash

set -ex

# Set up display; otherwise rendering will fail
Xvfb -screen 0 1024x768x24 &
disp_pid=$!
export DISPLAY=:0

# Wait for the file to come up
file="/tmp/.X11-unix/X0"
for i in {1..10}; do
if [ -e "$file" ]; then
break
fi

# Copy code
echo "Waiting for $file to be created (try $i/10)"
sleep "$i"
done

if ! [ -e "$file" ]; then
echo "Timing out: $file was not created"
kill $disp_pid
exit 1
fi

exec "$@"

# Add trap to cleanup and exit when script is interrupted
trap "kill $disp_pid; exit" INT TERM

# Wait for background process to finish
wait $disp_pid

# Exit with the exit code of the last executed command
exit $?



